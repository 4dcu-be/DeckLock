{% extends 'base.html' %}
{% import 'macros/card_list_item.html' as card_list_item %}
{% block title %}
{{ SITENAME }} - {{ article.title }}
{% endblock %}

{% block extra_css %}
<link href="{{ SITEURL }}/theme/css/mana-cost.css" rel="stylesheet" />
{% endblock extra_css %}

{% block container %}
    <ol class="breadcrumb top15">
      <li class="breadcrumb-item"><a href="{{ SITEURL }}/index.html">DeckLock</a></li>
      <li class="breadcrumb-item"><a href="{{ SITEURL }}/mtg.html">Magic: the Gathering</a></li>
      <li class="breadcrumb-item active">{{ article.title }}</li>
    </ol>

<h1>{{ article.title }} <small>{{ article.format }}</small></h1>
{% if article.description|length > 0 %}
    <div class="row">
        <div class="col-md-8 top15">
            {{ article.description | md }}
        </div>
    </div>
{% endif %}
<div class="row">
    <div class="col-md-8 top15">
        <div class="card h-100">
            <div class="card-header"><h3>Main Deck</h3></div>
            <div class="card-body">
                <div class="row">
                    <div class="col-lg">
                    <h4>Lands</h4>
                    <ul class="card_list">
                        {% for card in article.deck.main|sort(attribute='name') %}
                            {% if card.card_type == "land" %}
                                {{ card_list_item.print(card, USE_EXTERNAL_LINKS) }}
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <h4>Creatures</h4>
                    <ul class="card_list">
                        {% for card in article.deck.main|sort(attribute='name') %}
                            {% if card.card_type == "creature" %}
                                {{ card_list_item.print(card, USE_EXTERNAL_LINKS) }}
                            {% endif %}
                        {% endfor %}
                    </ul>
                    </div>
                    <div class="col-lg">
                    <h4>Instants and Sorceries</h4>
                    <ul class="card_list">
                        {% for card in article.deck.main|sort(attribute='name') %}
                            {% if card.card_type == "instant" or card.card_type == "sorcery" %}
                                {{ card_list_item.print(card, USE_EXTERNAL_LINKS) }}
                            {% endif %}
                        {% endfor %}
                    </ul>
                    <h4>Other Spells</h4>
                    <ul class="card_list">
                        {% for card in article.deck.main|sort(attribute='name') %}
                            {% if not card.card_type in ["creature", "instant", "sorcery", "land"] %}
                                {{ card_list_item.print(card, USE_EXTERNAL_LINKS) }}
                            {% endif %}
                        {% endfor %}
                    </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4 top15">
        <div class="card h-100">
            <div class="card-header"><h3>Sideboard</h3></div>
            <div class="card-body">
                <ul class="card_list">
                    {% for card in article.deck.sideboard|sort(attribute='name') %}
                        {{ card_list_item.print(card, USE_EXTERNAL_LINKS) }}
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-12 col-md-6 col-lg-4 top15">
        <div class="card plot">
        <canvas id="cmcStats" width="400" height="400"></canvas>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-12 top15">
        <div class="card h-100">
            <div class="card-header"><h3>Visual</h3></div>
            <div class="card-body">
                <div>
                    {% for stack in article.deck.main_stacks %}
                        <div class="card-stack" style="height:{{330 + (stack|length * 40) }}px">
                            {% for item in stack %}
                            {{ card_list_item.card_image(article.deck.main[item], USE_EXTERNAL_LINKS, "mtg-overview-position-" + loop.index|string) }}
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
                <div style="clear:both">
                    <h4>Sideboard</h4>
                    {% for stack in article.deck.sideboard_stacks %}
                        <div class="card-stack" style="height:{{330 + (stack|length * 40) }}px">
                            {% for item in stack %}
                            {{ card_list_item.card_image(article.deck.sideboard[item], USE_EXTERNAL_LINKS, "mtg-overview-position-" + loop.index|string) }}
                            {% endfor %}
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
$(function () {
  $('[data-toggle="popover"]').popover({html: true})
})
</script>
<script>
var ctx = document.getElementById('cmcStats').getContext('2d');
var myChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "10+"],
        datasets: [{% for color, data in article.deck.cmc_distribution.items() %}
        {
            label: '{{ color }}',
            data: [{{ data|join(', ') }}],
                    borderColor: '{{ article.deck.cmc_distribution_colors[color][0] }}',
                    backgroundColor: '{{ article.deck.cmc_distribution_colors[color][1] }}'
        },
        {% endfor %}]
    },
    options: {
        plugins: {
            legend: {
                display: false
            }
        },
        scales: {
            x: {
                stacked: true,
                ticks: {
                    display: true
                }
            },
            y: {
                stacked: true
            }
        }
    }
});
</script>
{% endblock %}